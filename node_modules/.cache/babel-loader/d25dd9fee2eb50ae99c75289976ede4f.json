{"ast":null,"code":"// make sourcemaps work!\nrequire(\"source-map-support/register\");\n\nvar Provider = require(\"./provider\");\n\nvar webSocketServer = require(\"./webSocketServer\");\n\nvar httpServer = require(\"./httpServer\");\n\nvar _ = require(\"lodash\");\n\nmodule.exports = {\n  create: function (options) {\n    options = _applyDefaultOptions(options || {});\n    var logger = options.logger;\n    var provider = new Provider(options);\n    var server = httpServer(provider, logger);\n    server.keepAliveTimeout = options.keepAliveTimeout;\n    let connectionCounter = 0;\n    const connections = {};\n    server.on(\"connection\", conn => {\n      const key = connectionCounter++;\n      connections[key] = conn;\n      conn.on(\"close\", () => delete connections[key]);\n    });\n    var oldListen = server.listen;\n\n    server.listen = function () {\n      var args = Array.prototype.slice.call(arguments);\n\n      var callback = function () {};\n\n      if (args.length > 0) {\n        var last = args[args.length - 1];\n\n        if (typeof last === \"function\") {\n          callback = args.pop();\n        }\n      }\n\n      var intermediary = function (err) {\n        if (err) {\n          return callback(err);\n        }\n\n        server.provider.manager.waitForInitialization(callback);\n      };\n\n      args.push(intermediary);\n      oldListen.apply(server, args);\n    };\n\n    server.provider = provider;\n\n    if (options.ws) {\n      webSocketServer(server, provider, logger);\n    }\n\n    var oldClose = server.close;\n\n    server.close = function (callback) {\n      var args = Array.prototype.slice.call(arguments);\n      oldClose.apply(server, args);\n      server.provider.close(function (err) {\n        if (err) {\n          return callback(err);\n        }\n\n        Object.keys(connections).forEach(key => {\n          try {\n            connections[key].destroy();\n          } catch (error) {}\n        });\n      });\n    };\n\n    return server;\n  }\n};\nconst defaultOptions = {\n  logger: {\n    log: function () {}\n  },\n  ws: true,\n  keepAliveTimeout: 5000\n};\n\nvar _applyDefaultOptions = function (options) {\n  return _.merge({}, defaultOptions, options);\n};","map":{"version":3,"names":["require","Provider","webSocketServer","httpServer","_","module","exports","create","options","_applyDefaultOptions","logger","provider","server","keepAliveTimeout","connectionCounter","connections","on","conn","key","oldListen","listen","args","Array","prototype","slice","call","arguments","callback","length","last","pop","intermediary","err","manager","waitForInitialization","push","apply","ws","oldClose","close","Object","keys","forEach","destroy","error","defaultOptions","log","merge"],"sources":["F:/Games/slotmachinereact/node_modules/ganache-core/lib/server.js"],"sourcesContent":["// make sourcemaps work!\nrequire(\"source-map-support/register\");\n\nvar Provider = require(\"./provider\");\nvar webSocketServer = require(\"./webSocketServer\");\nvar httpServer = require(\"./httpServer\");\nvar _ = require(\"lodash\");\n\nmodule.exports = {\n  create: function(options) {\n    options = _applyDefaultOptions(options || {});\n\n    var logger = options.logger;\n    var provider = new Provider(options);\n\n    var server = httpServer(provider, logger);\n    server.keepAliveTimeout = options.keepAliveTimeout;\n\n    let connectionCounter = 0;\n    const connections = {};\n    server.on(\"connection\", (conn) => {\n      const key = connectionCounter++;\n      connections[key] = conn;\n      conn.on(\"close\", () => delete connections[key]);\n    });\n\n    var oldListen = server.listen;\n\n    server.listen = function() {\n      var args = Array.prototype.slice.call(arguments);\n      var callback = function() {};\n      if (args.length > 0) {\n        var last = args[args.length - 1];\n        if (typeof last === \"function\") {\n          callback = args.pop();\n        }\n      }\n\n      var intermediary = function(err) {\n        if (err) {\n          return callback(err);\n        }\n        server.provider.manager.waitForInitialization(callback);\n      };\n\n      args.push(intermediary);\n\n      oldListen.apply(server, args);\n    };\n\n    server.provider = provider;\n\n    if (options.ws) {\n      webSocketServer(server, provider, logger);\n    }\n\n    var oldClose = server.close;\n\n    server.close = function(callback) {\n      var args = Array.prototype.slice.call(arguments);\n      oldClose.apply(server, args);\n\n      server.provider.close(function(err) {\n        if (err) {\n          return callback(err);\n        }\n        Object.keys(connections).forEach((key) => {\n          try {\n            connections[key].destroy();\n          } catch (error) {}\n        });\n      });\n    };\n\n    return server;\n  }\n};\n\nconst defaultOptions = {\n  logger: {\n    log: function() {}\n  },\n  ws: true,\n  keepAliveTimeout: 5000\n};\n\nvar _applyDefaultOptions = function(options) {\n  return _.merge({}, defaultOptions, options);\n};\n"],"mappings":"AAAA;AACAA,OAAO,CAAC,6BAAD,CAAP;;AAEA,IAAIC,QAAQ,GAAGD,OAAO,CAAC,YAAD,CAAtB;;AACA,IAAIE,eAAe,GAAGF,OAAO,CAAC,mBAAD,CAA7B;;AACA,IAAIG,UAAU,GAAGH,OAAO,CAAC,cAAD,CAAxB;;AACA,IAAII,CAAC,GAAGJ,OAAO,CAAC,QAAD,CAAf;;AAEAK,MAAM,CAACC,OAAP,GAAiB;EACfC,MAAM,EAAE,UAASC,OAAT,EAAkB;IACxBA,OAAO,GAAGC,oBAAoB,CAACD,OAAO,IAAI,EAAZ,CAA9B;IAEA,IAAIE,MAAM,GAAGF,OAAO,CAACE,MAArB;IACA,IAAIC,QAAQ,GAAG,IAAIV,QAAJ,CAAaO,OAAb,CAAf;IAEA,IAAII,MAAM,GAAGT,UAAU,CAACQ,QAAD,EAAWD,MAAX,CAAvB;IACAE,MAAM,CAACC,gBAAP,GAA0BL,OAAO,CAACK,gBAAlC;IAEA,IAAIC,iBAAiB,GAAG,CAAxB;IACA,MAAMC,WAAW,GAAG,EAApB;IACAH,MAAM,CAACI,EAAP,CAAU,YAAV,EAAyBC,IAAD,IAAU;MAChC,MAAMC,GAAG,GAAGJ,iBAAiB,EAA7B;MACAC,WAAW,CAACG,GAAD,CAAX,GAAmBD,IAAnB;MACAA,IAAI,CAACD,EAAL,CAAQ,OAAR,EAAiB,MAAM,OAAOD,WAAW,CAACG,GAAD,CAAzC;IACD,CAJD;IAMA,IAAIC,SAAS,GAAGP,MAAM,CAACQ,MAAvB;;IAEAR,MAAM,CAACQ,MAAP,GAAgB,YAAW;MACzB,IAAIC,IAAI,GAAGC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,CAAX;;MACA,IAAIC,QAAQ,GAAG,YAAW,CAAE,CAA5B;;MACA,IAAIN,IAAI,CAACO,MAAL,GAAc,CAAlB,EAAqB;QACnB,IAAIC,IAAI,GAAGR,IAAI,CAACA,IAAI,CAACO,MAAL,GAAc,CAAf,CAAf;;QACA,IAAI,OAAOC,IAAP,KAAgB,UAApB,EAAgC;UAC9BF,QAAQ,GAAGN,IAAI,CAACS,GAAL,EAAX;QACD;MACF;;MAED,IAAIC,YAAY,GAAG,UAASC,GAAT,EAAc;QAC/B,IAAIA,GAAJ,EAAS;UACP,OAAOL,QAAQ,CAACK,GAAD,CAAf;QACD;;QACDpB,MAAM,CAACD,QAAP,CAAgBsB,OAAhB,CAAwBC,qBAAxB,CAA8CP,QAA9C;MACD,CALD;;MAOAN,IAAI,CAACc,IAAL,CAAUJ,YAAV;MAEAZ,SAAS,CAACiB,KAAV,CAAgBxB,MAAhB,EAAwBS,IAAxB;IACD,CApBD;;IAsBAT,MAAM,CAACD,QAAP,GAAkBA,QAAlB;;IAEA,IAAIH,OAAO,CAAC6B,EAAZ,EAAgB;MACdnC,eAAe,CAACU,MAAD,EAASD,QAAT,EAAmBD,MAAnB,CAAf;IACD;;IAED,IAAI4B,QAAQ,GAAG1B,MAAM,CAAC2B,KAAtB;;IAEA3B,MAAM,CAAC2B,KAAP,GAAe,UAASZ,QAAT,EAAmB;MAChC,IAAIN,IAAI,GAAGC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,CAAX;MACAY,QAAQ,CAACF,KAAT,CAAexB,MAAf,EAAuBS,IAAvB;MAEAT,MAAM,CAACD,QAAP,CAAgB4B,KAAhB,CAAsB,UAASP,GAAT,EAAc;QAClC,IAAIA,GAAJ,EAAS;UACP,OAAOL,QAAQ,CAACK,GAAD,CAAf;QACD;;QACDQ,MAAM,CAACC,IAAP,CAAY1B,WAAZ,EAAyB2B,OAAzB,CAAkCxB,GAAD,IAAS;UACxC,IAAI;YACFH,WAAW,CAACG,GAAD,CAAX,CAAiByB,OAAjB;UACD,CAFD,CAEE,OAAOC,KAAP,EAAc,CAAE;QACnB,CAJD;MAKD,CATD;IAUD,CAdD;;IAgBA,OAAOhC,MAAP;EACD;AAnEc,CAAjB;AAsEA,MAAMiC,cAAc,GAAG;EACrBnC,MAAM,EAAE;IACNoC,GAAG,EAAE,YAAW,CAAE;EADZ,CADa;EAIrBT,EAAE,EAAE,IAJiB;EAKrBxB,gBAAgB,EAAE;AALG,CAAvB;;AAQA,IAAIJ,oBAAoB,GAAG,UAASD,OAAT,EAAkB;EAC3C,OAAOJ,CAAC,CAAC2C,KAAF,CAAQ,EAAR,EAAYF,cAAZ,EAA4BrC,OAA5B,CAAP;AACD,CAFD"},"metadata":{},"sourceType":"script"}