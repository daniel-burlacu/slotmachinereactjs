{"ast":null,"code":"var _jsxFileName = \"F:\\\\Games\\\\slotmachinereact\\\\src\\\\components\\\\Withdrawal.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useRef } from \"react\";\nimport '../assets/css/App.css';\nimport { ethers } from \"ethers\";\nimport PFPRacerNFT from '../artifacts/contracts/PFPRacerNFT.sol/PFPRacerNFT.json';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Withdrawal = props => {\n  _s();\n\n  const [rolling, setRolling] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [account, setAccount] = useState(\"\");\n  const [contract, setContract] = useState(\"\");\n  let refCode = \"\";\n  let smartKey = \"\";\n\n  const createSmartKey = async refCode => {\n    const result = await fetch('http://localhost:8000/secrets');\n    await axios.get('http://localhost:8000/secrets', {\n      methodL: 'POST',\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify(refCode)\n    });\n\n    try {\n      const resp = await axios.post('http://localhost:8000/secrets', refCode);\n    } catch (error) {\n      console.log(\"My error is:\" + error.response.data);\n    } //      const resultInJson = await result.json();\n    //      console.log()\n    //     await fetch('http://localhost:8000/secrets').then(res => {\n    //        if(res.ok){\n    //          return res.json()\n    //        }\n    //      }).then(jsonResponse => console.log(jsonResponse.secretKey) )\n\n\n    console.log(\"smartkey = \" + smartKey);\n    console.log(\"smartKey + refCode = \" + smartKey + refCode);\n  };\n\n  const initConnection = async () => {\n    if (typeof window.ethereum !== \"undefined\") {\n      const accounts = await window.ethereum.request({\n        method: \"eth_requestAccounts\"\n      });\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const newSigner = provider.getSigner();\n      setAccount(accounts[0]);\n      setContract(new ethers.Contract(\"0xE0059D8C4242BDf03c9ca37E0e651c07b1b9d587\", PFPRacerNFT.abi, newSigner));\n    } else {\n      console.log(\"Please install metamask\");\n    }\n  };\n\n  const getNFTBalance = async () => {\n    let balance = await contract.getNFTBalance();\n    console.log(\"How many NFT's have been  minted ? \" + balance);\n    return balance;\n  };\n\n  const howManyNFTsAreLeft = async () => {\n    let totalNFT = await contract.maxSupply();\n    let mintedNFT = await getNFTBalance();\n    let nftLeftToMint = totalNFT - mintedNFT;\n    console.log(\"Total NFT's left to mint \" + nftLeftToMint);\n  };\n\n  useEffect(() => {\n    initConnection();\n  }, [account]);\n\n  const makeWithdrawal = async refCode => {\n    let score = Math.floor(props.getScoreCallback());\n    console.log(\"My score in makeWithdrawal is \" + score);\n\n    if (score > 0) {\n      window.confirm(\"Please be aware: if you have 1.2 or 20.2 NFT's you will be able to withdrawal only the integer part like 1 or 2.\"); //await contract.withdrawal(refCode);\n\n      console.log(\"This is the withdrawal function !!!\");\n      await contract.withdrawal(score, refCode);\n      let myScr = props.getScoreCallback() - score;\n      console.log(\"My score is \" + myScr); //props.callbackSetScore(myScr);\n\n      props.setScoreCallBack(myScr);\n    }\n  };\n\n  const withdrawal = () => {\n    console.log(\"My withdrawal is: \" + props.blockWithdraw);\n\n    if (!props.blockWithdraw) {\n      let score = Math.floor(props.getScoreCallback());\n      console.log(\"Withdrawal has been activated\");\n      console.log(\"My account is: \" + account);\n      howManyNFTsAreLeft();\n\n      if (score > 0) {\n        refCode = prompt(\"Please enter your refCode:\", \"RefCode\");\n\n        if (refCode == null || refCode == \"\" || refCode !== \"RACECOUPLE2022\") {\n          let text = \"Withdrawal has been canceled !!! You have the option to buy the NFT's\";\n          window.confirm(text);\n        } else {\n          createSmartKey(refCode); //  makeWithdrawal(refCode);\n        }\n      } else {\n        window.confirm(\"You need to have at least 1 NFT to withdrawal\");\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: withdrawal ? \"roll rolling\" : \"roll\",\n    onClick: () => {\n      withdrawal();\n    },\n    children: \"Withdrawal\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 128,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Withdrawal, \"YMWh4SPmI+fS85XywQLQRJu3nhQ=\");\n\n_c = Withdrawal;\nexport default Withdrawal;\n\nvar _c;\n\n$RefreshReg$(_c, \"Withdrawal\");","map":{"version":3,"names":["React","useEffect","useState","useRef","ethers","PFPRacerNFT","axios","Withdrawal","props","rolling","setRolling","name","setName","account","setAccount","contract","setContract","refCode","smartKey","createSmartKey","result","fetch","get","methodL","headers","body","JSON","stringify","resp","post","error","console","log","response","data","initConnection","window","ethereum","accounts","request","method","provider","providers","Web3Provider","newSigner","getSigner","Contract","abi","getNFTBalance","balance","howManyNFTsAreLeft","totalNFT","maxSupply","mintedNFT","nftLeftToMint","makeWithdrawal","score","Math","floor","getScoreCallback","confirm","withdrawal","myScr","setScoreCallBack","blockWithdraw","prompt","text"],"sources":["F:/Games/slotmachinereact/src/components/Withdrawal.js"],"sourcesContent":["import  React, { useEffect, useState, useRef } from \"react\";\r\nimport '../assets/css/App.css';\r\nimport {ethers} from \"ethers\";\r\nimport PFPRacerNFT from '../artifacts/contracts/PFPRacerNFT.sol/PFPRacerNFT.json'\r\nimport axios from 'axios';\r\n \r\nconst Withdrawal=(props)=>{\r\n    const [rolling, setRolling] = useState(false);\r\n    const [name, setName] = useState(\"\");\r\n    const [account, setAccount] = useState(\"\");\r\n    const [contract, setContract] = useState(\"\");\r\n    let refCode =\"\";\r\n    let smartKey = \"\";\r\n   \r\n\r\n    const createSmartKey = async (refCode) =>{\r\n      const result = await fetch('http://localhost:8000/secrets');\r\n\r\n      await axios.get ('http://localhost:8000/secrets',{\r\n        methodL:'POST',\r\n        headers: {\r\n          'Content-type': 'application/json'\r\n        },\r\n        body: JSON.stringify(refCode)\r\n      });   \r\n      \r\n      try{\r\n        const resp = await axios.post('http://localhost:8000/secrets',refCode);\r\n      }catch(error){\r\n        console.log(\"My error is:\"+error.response.data);\r\n      }\r\n\r\n//      const resultInJson = await result.json();\r\n\r\n//      console.log()\r\n\r\n\r\n//     await fetch('http://localhost:8000/secrets').then(res => {\r\n//        if(res.ok){\r\n//          return res.json()\r\n//        }\r\n//      }).then(jsonResponse => console.log(jsonResponse.secretKey) )\r\n\r\n      console.log(\"smartkey = \"+smartKey);\r\n      console.log(\"smartKey + refCode = \"+smartKey+refCode);\r\n    }\r\n\r\n    const initConnection = async () =>{\r\n      if(typeof window.ethereum !== \"undefined\"){\r\n        const accounts = await window.ethereum.request({\r\n          method: \"eth_requestAccounts\",\r\n        });\r\n        const provider = new ethers.providers.Web3Provider(window.ethereum);\r\n        const newSigner = provider.getSigner();\r\n        setAccount(accounts[0]);\r\n        setContract(\r\n          new ethers.Contract(\r\n            \"0xE0059D8C4242BDf03c9ca37E0e651c07b1b9d587\",\r\n            PFPRacerNFT.abi,\r\n            newSigner\r\n          )\r\n        )\r\n      }else{\r\n        console.log(\"Please install metamask\");\r\n      }\r\n    }\r\n\r\n    const getNFTBalance = async () =>{\r\n      let balance = await contract.getNFTBalance();\r\n      console.log(\"How many NFT's have been  minted ? \"+balance );\r\n\r\n      return balance;\r\n    }\r\n\r\n    const howManyNFTsAreLeft = async () =>{\r\n      let totalNFT = await contract.maxSupply();\r\n      let mintedNFT= await getNFTBalance();\r\n      let nftLeftToMint = totalNFT -mintedNFT;\r\n\r\n      console.log(\"Total NFT's left to mint \"+nftLeftToMint);\r\n    }\r\n\r\n    useEffect(()=>{\r\n      initConnection();\r\n    },[account]);\r\n\r\n  const makeWithdrawal = async(refCode) => {\r\n    let score = Math.floor(props.getScoreCallback());\r\n    console.log(\"My score in makeWithdrawal is \"+score);\r\n     if(score > 0){\r\n    window.confirm(\"Please be aware: if you have 1.2 or 20.2 NFT's you will be able to withdrawal only the integer part like 1 or 2.\");\r\n    //await contract.withdrawal(refCode);\r\n    console.log(\"This is the withdrawal function !!!\");\r\n    \r\n    await contract.withdrawal(score,refCode);\r\n    \r\n    let myScr= props.getScoreCallback()-score;\r\n    console.log(\"My score is \"+myScr);\r\n    //props.callbackSetScore(myScr);\r\n    props.setScoreCallBack(myScr);\r\n    }\r\n  }\r\n    \r\n  const withdrawal = () => {\r\n    console.log(\"My withdrawal is: \"+props.blockWithdraw);\r\n    if(!props.blockWithdraw){\r\n    let score = Math.floor(props.getScoreCallback());\r\n        console.log(\"Withdrawal has been activated\");\r\n        console.log(\"My account is: \"+account);\r\n        howManyNFTsAreLeft();\r\n  if(score>0){\r\n    refCode = prompt(\"Please enter your refCode:\", \"RefCode\");\r\n    if (refCode == null || refCode == \"\" || refCode !== \"RACECOUPLE2022\") {\r\n      let text = \"Withdrawal has been canceled !!! You have the option to buy the NFT's\";\r\n      window.confirm(text)\r\n    } else {\r\n        createSmartKey(refCode);\r\n      //  makeWithdrawal(refCode);\r\n      }\r\n    \r\n  }else{\r\n    window.confirm(\"You need to have at least 1 NFT to withdrawal\");\r\n  }\r\n} \r\n};\r\n\r\n    return(\r\n    <div\r\n         className={withdrawal ? \"roll rolling\" : \"roll\"}\r\n         onClick={() => {withdrawal()}}\r\n    >Withdrawal</div>\r\n    )\r\n}\r\n\r\nexport default Withdrawal;"],"mappings":";;;AAAA,OAAQA,KAAR,IAAiBC,SAAjB,EAA4BC,QAA5B,EAAsCC,MAAtC,QAAoD,OAApD;AACA,OAAO,uBAAP;AACA,SAAQC,MAAR,QAAqB,QAArB;AACA,OAAOC,WAAP,MAAwB,yDAAxB;AACA,OAAOC,KAAP,MAAkB,OAAlB;;;AAEA,MAAMC,UAAU,GAAEC,KAAD,IAAS;EAAA;;EACtB,MAAM,CAACC,OAAD,EAAUC,UAAV,IAAwBR,QAAQ,CAAC,KAAD,CAAtC;EACA,MAAM,CAACS,IAAD,EAAOC,OAAP,IAAkBV,QAAQ,CAAC,EAAD,CAAhC;EACA,MAAM,CAACW,OAAD,EAAUC,UAAV,IAAwBZ,QAAQ,CAAC,EAAD,CAAtC;EACA,MAAM,CAACa,QAAD,EAAWC,WAAX,IAA0Bd,QAAQ,CAAC,EAAD,CAAxC;EACA,IAAIe,OAAO,GAAE,EAAb;EACA,IAAIC,QAAQ,GAAG,EAAf;;EAGA,MAAMC,cAAc,GAAG,MAAOF,OAAP,IAAkB;IACvC,MAAMG,MAAM,GAAG,MAAMC,KAAK,CAAC,+BAAD,CAA1B;IAEA,MAAMf,KAAK,CAACgB,GAAN,CAAW,+BAAX,EAA2C;MAC/CC,OAAO,EAAC,MADuC;MAE/CC,OAAO,EAAE;QACP,gBAAgB;MADT,CAFsC;MAK/CC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeV,OAAf;IALyC,CAA3C,CAAN;;IAQA,IAAG;MACD,MAAMW,IAAI,GAAG,MAAMtB,KAAK,CAACuB,IAAN,CAAW,+BAAX,EAA2CZ,OAA3C,CAAnB;IACD,CAFD,CAEC,OAAMa,KAAN,EAAY;MACXC,OAAO,CAACC,GAAR,CAAY,iBAAeF,KAAK,CAACG,QAAN,CAAeC,IAA1C;IACD,CAfsC,CAiB7C;IAEA;IAGA;IACA;IACA;IACA;IACA;;;IAEMH,OAAO,CAACC,GAAR,CAAY,gBAAcd,QAA1B;IACAa,OAAO,CAACC,GAAR,CAAY,0BAAwBd,QAAxB,GAAiCD,OAA7C;EACD,CA9BD;;EAgCA,MAAMkB,cAAc,GAAG,YAAW;IAChC,IAAG,OAAOC,MAAM,CAACC,QAAd,KAA2B,WAA9B,EAA0C;MACxC,MAAMC,QAAQ,GAAG,MAAMF,MAAM,CAACC,QAAP,CAAgBE,OAAhB,CAAwB;QAC7CC,MAAM,EAAE;MADqC,CAAxB,CAAvB;MAGA,MAAMC,QAAQ,GAAG,IAAIrC,MAAM,CAACsC,SAAP,CAAiBC,YAArB,CAAkCP,MAAM,CAACC,QAAzC,CAAjB;MACA,MAAMO,SAAS,GAAGH,QAAQ,CAACI,SAAT,EAAlB;MACA/B,UAAU,CAACwB,QAAQ,CAAC,CAAD,CAAT,CAAV;MACAtB,WAAW,CACT,IAAIZ,MAAM,CAAC0C,QAAX,CACE,4CADF,EAEEzC,WAAW,CAAC0C,GAFd,EAGEH,SAHF,CADS,CAAX;IAOD,CAdD,MAcK;MACHb,OAAO,CAACC,GAAR,CAAY,yBAAZ;IACD;EACF,CAlBD;;EAoBA,MAAMgB,aAAa,GAAG,YAAW;IAC/B,IAAIC,OAAO,GAAG,MAAMlC,QAAQ,CAACiC,aAAT,EAApB;IACAjB,OAAO,CAACC,GAAR,CAAY,wCAAsCiB,OAAlD;IAEA,OAAOA,OAAP;EACD,CALD;;EAOA,MAAMC,kBAAkB,GAAG,YAAW;IACpC,IAAIC,QAAQ,GAAG,MAAMpC,QAAQ,CAACqC,SAAT,EAArB;IACA,IAAIC,SAAS,GAAE,MAAML,aAAa,EAAlC;IACA,IAAIM,aAAa,GAAGH,QAAQ,GAAEE,SAA9B;IAEAtB,OAAO,CAACC,GAAR,CAAY,8BAA4BsB,aAAxC;EACD,CAND;;EAQArD,SAAS,CAAC,MAAI;IACZkC,cAAc;EACf,CAFQ,EAEP,CAACtB,OAAD,CAFO,CAAT;;EAIF,MAAM0C,cAAc,GAAG,MAAMtC,OAAN,IAAkB;IACvC,IAAIuC,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWlD,KAAK,CAACmD,gBAAN,EAAX,CAAZ;IACA5B,OAAO,CAACC,GAAR,CAAY,mCAAiCwB,KAA7C;;IACC,IAAGA,KAAK,GAAG,CAAX,EAAa;MACdpB,MAAM,CAACwB,OAAP,CAAe,kHAAf,EADc,CAEd;;MACA7B,OAAO,CAACC,GAAR,CAAY,qCAAZ;MAEA,MAAMjB,QAAQ,CAAC8C,UAAT,CAAoBL,KAApB,EAA0BvC,OAA1B,CAAN;MAEA,IAAI6C,KAAK,GAAEtD,KAAK,CAACmD,gBAAN,KAAyBH,KAApC;MACAzB,OAAO,CAACC,GAAR,CAAY,iBAAe8B,KAA3B,EARc,CASd;;MACAtD,KAAK,CAACuD,gBAAN,CAAuBD,KAAvB;IACC;EACF,CAfD;;EAiBA,MAAMD,UAAU,GAAG,MAAM;IACvB9B,OAAO,CAACC,GAAR,CAAY,uBAAqBxB,KAAK,CAACwD,aAAvC;;IACA,IAAG,CAACxD,KAAK,CAACwD,aAAV,EAAwB;MACxB,IAAIR,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWlD,KAAK,CAACmD,gBAAN,EAAX,CAAZ;MACI5B,OAAO,CAACC,GAAR,CAAY,+BAAZ;MACAD,OAAO,CAACC,GAAR,CAAY,oBAAkBnB,OAA9B;MACAqC,kBAAkB;;MACxB,IAAGM,KAAK,GAAC,CAAT,EAAW;QACTvC,OAAO,GAAGgD,MAAM,CAAC,4BAAD,EAA+B,SAA/B,CAAhB;;QACA,IAAIhD,OAAO,IAAI,IAAX,IAAmBA,OAAO,IAAI,EAA9B,IAAoCA,OAAO,KAAK,gBAApD,EAAsE;UACpE,IAAIiD,IAAI,GAAG,uEAAX;UACA9B,MAAM,CAACwB,OAAP,CAAeM,IAAf;QACD,CAHD,MAGO;UACH/C,cAAc,CAACF,OAAD,CAAd,CADG,CAEL;QACC;MAEJ,CAVD,MAUK;QACHmB,MAAM,CAACwB,OAAP,CAAe,+CAAf;MACD;IACF;EACA,CArBC;;EAuBE,oBACA;IACK,SAAS,EAAEC,UAAU,GAAG,cAAH,GAAoB,MAD9C;IAEK,OAAO,EAAE,MAAM;MAACA,UAAU;IAAG,CAFlC;IAAA;EAAA;IAAA;IAAA;IAAA;EAAA,QADA;AAMH,CA9HD;;GAAMtD,U;;KAAAA,U;AAgIN,eAAeA,UAAf"},"metadata":{},"sourceType":"module"}