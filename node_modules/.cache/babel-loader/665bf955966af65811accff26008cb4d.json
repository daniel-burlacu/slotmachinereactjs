{"ast":null,"code":"// this replaces `eth-block-tracker` in the provider-engine, as that block tracker is meant to work with\n// an external provider instance\nconst EventEmitter = require(\"events\");\n\nvar blockHelper = require(\"./utils/block_helper\");\n\nfunction GanacheBlockTracker(opts) {\n  opts = opts || {};\n  EventEmitter.apply(this);\n\n  if (!opts.blockchain) {\n    throw new Error(\"RpcBlockTracker - no blockchain specified.\");\n  }\n\n  if (!opts.blockchain.on) {\n    throw new Error(\"RpcBlockTracker - blockchain is not an EventEmitter.\");\n  }\n\n  this._blockchain = opts.blockchain;\n  this.start = this.start.bind(this);\n  this.stop = this.stop.bind(this);\n  this.getTrackingBlock = this.getTrackingBlock.bind(this);\n  this.awaitCurrentBlock = this.awaitCurrentBlock.bind(this);\n  this._setCurrentBlock = this._setCurrentBlock.bind(this);\n}\n\nGanacheBlockTracker.prototype = Object.create(EventEmitter.prototype);\nGanacheBlockTracker.prototype.constructor = GanacheBlockTracker;\n\nGanacheBlockTracker.prototype.getTrackingBlock = function () {\n  return this._currentBlock;\n};\n\nGanacheBlockTracker.prototype.getCurrentBlock = function () {\n  return this._currentBlock;\n};\n\nGanacheBlockTracker.prototype.awaitCurrentBlock = function () {\n  const self = this; // return if available\n\n  if (this._currentBlock) {\n    return this._currentBlock;\n  } // wait for \"sync\" event\n\n\n  return new Promise(resolve => this.once(\"block\", resolve)).then(() => self._currentBlock);\n};\n\nGanacheBlockTracker.prototype.start = function () {\n  let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  this._blockchain.on(\"block\", this._setCurrentBlock);\n\n  return Promise.resolve();\n};\n\nGanacheBlockTracker.prototype.stop = function () {\n  this._isRunning = false;\n\n  this._blockchain.removeListener(\"block\", this._setCurrentBlock);\n}; //\n// private\n//\n\n\nGanacheBlockTracker.prototype._setCurrentBlock = function (newBlock) {\n  const block = blockHelper.toJSON(newBlock, true);\n\n  if (this._currentBlock && this._currentBlock.hash === block.hash) {\n    return;\n  }\n\n  const oldBlock = this._currentBlock;\n  this._currentBlock = block;\n  this.emit(\"latest\", block);\n  this.emit(\"sync\", {\n    block,\n    oldBlock\n  });\n  this.emit(\"block\", block);\n};\n\nmodule.exports = GanacheBlockTracker;","map":{"version":3,"names":["EventEmitter","require","blockHelper","GanacheBlockTracker","opts","apply","blockchain","Error","on","_blockchain","start","bind","stop","getTrackingBlock","awaitCurrentBlock","_setCurrentBlock","prototype","Object","create","constructor","_currentBlock","getCurrentBlock","self","Promise","resolve","once","then","_isRunning","removeListener","newBlock","block","toJSON","hash","oldBlock","emit","module","exports"],"sources":["F:/Games/slotmachinereact/node_modules/ganache-core/lib/block_tracker.js"],"sourcesContent":["// this replaces `eth-block-tracker` in the provider-engine, as that block tracker is meant to work with\n// an external provider instance\n\nconst EventEmitter = require(\"events\");\nvar blockHelper = require(\"./utils/block_helper\");\n\nfunction GanacheBlockTracker(opts) {\n  opts = opts || {};\n  EventEmitter.apply(this);\n  if (!opts.blockchain) {\n    throw new Error(\"RpcBlockTracker - no blockchain specified.\");\n  }\n  if (!opts.blockchain.on) {\n    throw new Error(\"RpcBlockTracker - blockchain is not an EventEmitter.\");\n  }\n  this._blockchain = opts.blockchain;\n  this.start = this.start.bind(this);\n  this.stop = this.stop.bind(this);\n  this.getTrackingBlock = this.getTrackingBlock.bind(this);\n  this.awaitCurrentBlock = this.awaitCurrentBlock.bind(this);\n  this._setCurrentBlock = this._setCurrentBlock.bind(this);\n}\n\nGanacheBlockTracker.prototype = Object.create(EventEmitter.prototype);\nGanacheBlockTracker.prototype.constructor = GanacheBlockTracker;\n\nGanacheBlockTracker.prototype.getTrackingBlock = function() {\n  return this._currentBlock;\n};\n\nGanacheBlockTracker.prototype.getCurrentBlock = function() {\n  return this._currentBlock;\n};\n\nGanacheBlockTracker.prototype.awaitCurrentBlock = function() {\n  const self = this;\n  // return if available\n  if (this._currentBlock) {\n    return this._currentBlock;\n  }\n  // wait for \"sync\" event\n  return new Promise((resolve) => this.once(\"block\", resolve)).then(() => self._currentBlock);\n};\n\nGanacheBlockTracker.prototype.start = function(opts = {}) {\n  this._blockchain.on(\"block\", this._setCurrentBlock);\n  return Promise.resolve();\n};\n\nGanacheBlockTracker.prototype.stop = function() {\n  this._isRunning = false;\n  this._blockchain.removeListener(\"block\", this._setCurrentBlock);\n};\n\n//\n// private\n//\n\nGanacheBlockTracker.prototype._setCurrentBlock = function(newBlock) {\n  const block = blockHelper.toJSON(newBlock, true);\n  if (this._currentBlock && this._currentBlock.hash === block.hash) {\n    return;\n  }\n  const oldBlock = this._currentBlock;\n  this._currentBlock = block;\n  this.emit(\"latest\", block);\n  this.emit(\"sync\", { block, oldBlock });\n  this.emit(\"block\", block);\n};\n\nmodule.exports = GanacheBlockTracker;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}