{"ast":null,"code":"import _regeneratorRuntime from\"F:/Games/slotmachinereact/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"F:/Games/slotmachinereact/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"F:/Games/slotmachinereact/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState,useRef}from\"react\";import'../assets/css/App.css';import{ethers}from\"ethers\";import PFPRacerNFT from'../artifacts/contracts/PFPRacerNFT.sol/abi.json';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var mintAmount=0;var Mint=function Mint(props){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),mintAmount=_useState2[0],setMintAmount=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),leftToMint=_useState4[0],setLeftToMint=_useState4[1];var url=\"https://vast-ridge-99820.herokuapp.com\";var howManyNFTsAreLeft=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var totalNFT,mintedNFT,nftLeftToMint;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"We are in howManyNFTsAreLeft\");totalNFT=\"\";mintedNFT=\"\";_context.prev=3;_context.next=6;return props.contract.getMaxSupply();case 6:totalNFT=_context.sent;console.log(\"totalNFT = \"+totalNFT);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](3);console.log(\"My error is: \"+_context.t0);totalNFT=\"ERR\";case 14:_context.prev=14;_context.next=17;return props.contract.getContractNFTBalance();case 17:mintedNFT=_context.sent;_context.next=25;break;case 20:_context.prev=20;_context.t1=_context[\"catch\"](14);console.log(\"Account is \"+props.account);console.log(\"Contract balance err is\"+_context.t1);mintedNFT=0;case 25:nftLeftToMint=totalNFT-mintedNFT;console.log(\"Left to mint\"+leftToMint);setLeftToMint(nftLeftToMint);case 28:case\"end\":return _context.stop();}}},_callee,null,[[3,10],[14,20]]);}));return function howManyNFTsAreLeft(){return _ref.apply(this,arguments);};}();var insertWalletIntoDB=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var dataToSend,link;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dataToSend=JSON.stringify({\"wallet\":props.account,\"txtype\":\"mint\",\"amount\":mintAmount});link=url+\"/api/insertWallet\";_context2.next=4;return fetch(link,{//  await fetch('http://localhost:3333/api/insertWallet', {\nmethod:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'},body:dataToSend});case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function insertWalletIntoDB(){return _ref2.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var transaction,errorTx,contractPaused,_window,ethereum,cost,options;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:transaction=\"\";errorTx=false;_context3.next=4;return props.contract.paused();case 4:contractPaused=_context3.sent;console.log(\"We are in the handleSubmit function\");if(contractPaused){_context3.next=46;break;}if(!(mintAmount>0&&mintAmount<1001)){_context3.next=43;break;}_context3.prev=8;_window=window,ethereum=_window.ethereum;if(!ethereum){_context3.next=35;break;}_context3.next=13;return props.contract.cost();case 13:cost=_context3.sent;cost=cost*mintAmount;cost=cost.toString();options={gasLimit:174860,nonce:45,value:ethers.utils.parseUnits(cost,'wei')};_context3.prev=17;_context3.next=20;return props.contract.mint(mintAmount,options);case 20:transaction=_context3.sent;_context3.next=27;break;case 23:_context3.prev=23;_context3.t0=_context3[\"catch\"](17);errorTx=true;alert(\"Transaction failed, please try again later ! Transaction has been reverted ! \");case 27:if(errorTx){_context3.next=33;break;}alert(\"Minted !! You can see transaction here:\"+\"<a href=\"+\"https://mumbai.polygonscan.com/tx/\".concat(transaction.hash)+\">Transaction</a>\");insertWalletIntoDB();_context3.next=32;return howManyNFTsAreLeft();case 32:setMintAmount(0);case 33:_context3.next=36;break;case 35:alert(\"Please connect to Metamask or install it if not already done !\");case 36:_context3.next=41;break;case 38:_context3.prev=38;_context3.t1=_context3[\"catch\"](8);alert(\"Network is crowded please try again later !\");case 41:_context3.next=44;break;case 43:if(mintAmount===0){alert(\"You need to mint at least 1 NFT\");}else if(mintAmount>1000){alert(\"Holly Molly what do you wanna do ? Hold your horses and leave some for the others too!!! \");}else{alert(\"Make sure you insert NUMBERS Only !!!\");}case 44:_context3.next=47;break;case 46:alert(\"Contract is PAUSED, you can't mint at this moment, please try again later\");case 47:case\"end\":return _context3.stop();}}},_callee3,null,[[8,38],[17,23]]);}));return function handleSubmit(){return _ref3.apply(this,arguments);};}();useEffect(function(){howManyNFTsAreLeft();},[mintAmount]);useEffect(function(){howManyNFTsAreLeft();},[mintAmount]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"div-form\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"form\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"label-mint\",children:[\"NFT's left to mint:\",/*#__PURE__*/_jsx(\"p\",{className:\"p-welcomeMint\",children:leftToMint}),\"\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\"]}),/*#__PURE__*/_jsxs(\"label\",{className:\"form-label\",children:[\"Mint Amount:\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:mintAmount,onChange:function onChange(e){return setMintAmount(e.target.value);}})]}),/*#__PURE__*/_jsx(\"label\",{className:\"label-mint\",children:\"Price per/NFT is 10 Matic\"})]})}),/*#__PURE__*/_jsx(\"button\",{className:\"form-submit-button\",onClick:function onClick(){handleSubmit(mintAmount);},children:\"Mint\"})]});};export default Mint;","map":{"version":3,"names":["React","useEffect","useState","useRef","ethers","PFPRacerNFT","mintAmount","Mint","props","setMintAmount","leftToMint","setLeftToMint","url","howManyNFTsAreLeft","console","log","totalNFT","mintedNFT","contract","getMaxSupply","getContractNFTBalance","account","nftLeftToMint","insertWalletIntoDB","dataToSend","JSON","stringify","link","fetch","method","headers","body","handleSubmit","transaction","errorTx","paused","contractPaused","window","ethereum","cost","toString","options","gasLimit","nonce","value","utils","parseUnits","mint","alert","hash","e","target"],"sources":["F:/Games/slotmachinereact/src/components/Mint.js"],"sourcesContent":["import  React, { useEffect, useState, useRef } from \"react\";\r\nimport '../assets/css/App.css';\r\nimport {ethers} from \"ethers\";\r\nimport PFPRacerNFT from '../artifacts/contracts/PFPRacerNFT.sol/abi.json';\r\n\r\nlet mintAmount=0;\r\n\r\nconst Mint = (props) =>{\r\n    const [mintAmount, setMintAmount] = useState(0);\r\n    const [leftToMint, setLeftToMint] = useState(0);\r\n        \r\n    const url=\"https://vast-ridge-99820.herokuapp.com\";\r\n\r\n\r\n    const howManyNFTsAreLeft = async () =>{\r\n      console.log(\"We are in howManyNFTsAreLeft\")\r\n      let totalNFT=\"\";\r\n      let mintedNFT=\"\";\r\n      try{\r\n        totalNFT = await props.contract.getMaxSupply();\r\n        console.log(\"totalNFT = \"+totalNFT);\r\n        }catch(err){\r\n          console.log(\"My error is: \"+err);\r\n          totalNFT=\"ERR\";\r\n        }\r\n      try{\r\n        mintedNFT= await props.contract.getContractNFTBalance(); \r\n      }catch(err){\r\n        console.log(\"Account is \"+props.account);\r\n        console.log(\"Contract balance err is\"+err);\r\n        mintedNFT=0;\r\n      }\r\n        let nftLeftToMint = totalNFT - mintedNFT;\r\n        console.log(\"Left to mint\"+leftToMint)\r\n        setLeftToMint(nftLeftToMint);\r\n      }\r\n\r\n      const insertWalletIntoDB = async()=>{\r\n\r\n        const dataToSend = JSON.stringify({ \"wallet\": props.account,\r\n                                            \"txtype\":\"mint\",\r\n                                            \"amount\":mintAmount,\r\n                                             });\r\n          const link = url+\"/api/insertWallet\";\r\n          await fetch(link,{\r\n      //  await fetch('http://localhost:3333/api/insertWallet', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Accept': 'application/json',\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: dataToSend\r\n        })\r\n    \r\n      }\r\n\r\nconst handleSubmit= async() =>{\r\n  let transaction = \"\";\r\n  let errorTx= false;\r\n  let contractPaused = await props.contract.paused();\r\n  console.log(\"We are in the handleSubmit function\");\r\n  if(!contractPaused){\r\n    if(mintAmount>0&&mintAmount<1001){\r\n        try{\r\n            const{ethereum}=window;\r\n\r\n            if(ethereum){\r\n   \r\n                let cost = await props.contract.cost();\r\n                cost = cost*mintAmount;\r\n                cost = cost.toString();\r\n                var options = { gasLimit: 174860, nonce: 45, value: ethers.utils.parseUnits(cost, 'wei') };\r\n              try{\r\n//                var options = { gasLimit: 174860, nonce: 45, value: ethers.utils.parseUnits(price, 'wei') };\r\n                transaction = await props.contract.mint(mintAmount, options);\r\n              }catch(err){\r\n                errorTx=true;\r\n                alert(\"Transaction failed, please try again later ! Transaction has been reverted ! \");\r\n              }\r\n              if(!errorTx){\r\n                alert(\"Minted !! You can see transaction here:\" +\"<a href=\"+`https://mumbai.polygonscan.com/tx/${transaction.hash}`+\">Transaction</a>\");\r\n                insertWalletIntoDB();\r\n                await howManyNFTsAreLeft();\r\n                setMintAmount(0);\r\n              }\r\n             } else{\r\n                alert(\"Please connect to Metamask or install it if not already done !\");\r\n             }   \r\n        }\r\n        catch(err){\r\n           alert(\"Network is crowded please try again later !\");\r\n        }\r\n     \r\n\r\n    }else{\r\n      if(mintAmount===0){\r\n        alert(\"You need to mint at least 1 NFT\");\r\n      }else if(mintAmount >1000){\r\n        alert(\"Holly Molly what do you wanna do ? Hold your horses and leave some for the others too!!! \");\r\n      }else{\r\n        alert(\"Make sure you insert NUMBERS Only !!!\");\r\n      }\r\n    }\r\n\r\n}else{\r\n  alert(\"Contract is PAUSED, you can't mint at this moment, please try again later\");\r\n}\r\n}\r\n\r\n    useEffect(()=>{\r\n\r\n      howManyNFTsAreLeft();\r\n    },[mintAmount])\r\n\r\n     useEffect(()=>{\r\n      howManyNFTsAreLeft();\r\n     },[mintAmount])\r\n\r\n      return (\r\n        <>\r\n        <div className=\"div-form\">\r\n        <form className=\"form\">\r\n        <label className=\"label-mint\">\r\n             NFT's left to mint:\r\n             <p className=\"p-welcomeMint\">{leftToMint}</p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        </label>\r\n          <label className=\"form-label\">\r\n            Mint Amount:\r\n            <input\r\n              type=\"text\"\r\n              value={mintAmount}\r\n              onChange={e => setMintAmount(e.target.value)}\r\n            />\r\n          </label>\r\n          <label className=\"label-mint\">\r\n            Price per/NFT is 10 Matic\r\n            </label>\r\n        </form>\r\n        </div>\r\n     <button className=\"form-submit-button\" onClick={()=>{handleSubmit(mintAmount)}}>Mint</button>\r\n     </>\r\n      );\r\n}\r\n\r\nexport default Mint;"],"mappings":"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"},"metadata":{},"sourceType":"module"}