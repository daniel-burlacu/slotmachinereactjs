{"ast":null,"code":"/*\nCopyright (c) 2020 Uber Technologies, Inc.\n\nThis source code is licensed under the MIT license found in the\nLICENSE file in the root directory of this source tree.\n*/\nimport React from 'react';\nimport { transformFromAstSync } from '@babel/core'; //@ts-ignore\n\nimport presetReact from '@babel/preset-react';\nimport { parse } from '../ast';\nimport { getStyles } from '../utils';\n\nconst errorBoundary = (Element, errorCallback) => {\n  class ErrorBoundary extends React.Component {\n    componentDidCatch(error) {\n      errorCallback(error);\n    }\n\n    render() {\n      if (typeof Element === 'undefined') return null;\n      return typeof Element === 'function' ? React.createElement(Element, null) : Element;\n    }\n\n  }\n\n  return ErrorBoundary;\n};\n\nconst evalCode = (ast, scope, presets) => {\n  const transformedCode = transformFromAstSync(ast, undefined, {\n    presets: presets ? [presetReact, ...presets] : [presetReact],\n    inputSourceMap: false,\n    sourceMaps: false,\n    comments: false,\n    // TS preset needs this and it doesn't seem to matter when TS preset\n    // is not used, so let's keep it here?\n    filename: 'file.tsx'\n  });\n  const resultCode = transformedCode ? transformedCode.code : '';\n  const scopeKeys = Object.keys(scope);\n  const scopeValues = Object.values(scope); //@ts-ignore\n\n  const res = new Function('React', ...scopeKeys, `return ${resultCode}`);\n  return res(React, ...scopeValues);\n};\n\nconst generateElement = (ast, scope, errorCallback, presets) => {\n  return errorBoundary(evalCode(ast, scope, presets), errorCallback);\n};\n\nconst transpile = (code, transformations, scope, setOutput, setError, presets) => {\n  try {\n    const ast = transformations.reduce((result, transformation) => transformation(result), parse(code));\n    const component = generateElement(ast, scope, error => {\n      setError(error.toString());\n    }, presets);\n    setOutput({\n      component\n    });\n    setError(null);\n  } catch (error) {\n    setError(error.toString());\n  }\n};\n\nconst Compiler = _ref => {\n  let {\n    scope,\n    code,\n    setError,\n    transformations,\n    placeholder,\n    minHeight,\n    presets,\n    className\n  } = _ref;\n  const [output, setOutput] = React.useState({\n    component: null\n  });\n  React.useEffect(() => {\n    transpile(code, transformations, scope, setOutput, setError, presets);\n  }, [code]);\n  const Element = output.component;\n  const Placeholder = placeholder;\n  return React.createElement(\"div\", Object.assign({}, getStyles({\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'baseline',\n    flexWrap: 'wrap',\n    minHeight: `${minHeight || 0}px`,\n    paddingTop: minHeight ? '16px' : 0,\n    paddingBottom: minHeight ? '16px' : 0\n  }, className)), Element ? React.createElement(Element, null) : Placeholder ? React.createElement(Placeholder, {\n    height: minHeight || 32\n  }) : null);\n};\n\nexport default React.memo(Compiler, (prevProps, nextProps) => prevProps.code === nextProps.code);","map":{"version":3,"mappings":"AAAA;;;;;;AAMA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,oBAAR,QAA+C,aAA/C,C,CAEA;;AACA,OAAOC,WAAP,MAAwB,qBAAxB;AACA,SAAQC,KAAR,QAAoB,QAApB;AAEA,SAAQC,SAAR,QAAwB,UAAxB;;AAEA,MAAMC,aAAa,GAAG,CACpBC,OADoB,EAEpBC,aAFoB,KAGlB;EACF,MAAMC,aAAN,SAA4BR,KAAK,CAACS,SAAlC,CAA2C;IACzCC,iBAAiB,CAACC,KAAD,EAAa;MAC5BJ,aAAa,CAACI,KAAD,CAAb;IACD;;IACDC,MAAM;MACJ,IAAI,OAAON,OAAP,KAAmB,WAAvB,EAAoC,OAAO,IAAP;MACpC,OAAO,OAAOA,OAAP,KAAmB,UAAnB,GAAgCN,oBAACM,OAAD,EAAQ,IAAR,CAAhC,GAA8CA,OAArD;IACD;;EAPwC;;EAS3C,OAAOE,aAAP;AACD,CAdD;;AAgBA,MAAMK,QAAQ,GAAG,CACfC,GADe,EAEfC,KAFe,EAGfC,OAHe,KAIb;EACF,MAAMC,eAAe,GAAGhB,oBAAoB,CAC1Ca,GAD0C,EAE1CI,SAF0C,EAG1C;IACEF,OAAO,EAAEA,OAAO,GAAG,CAACd,WAAD,EAAc,GAAGc,OAAjB,CAAH,GAA+B,CAACd,WAAD,CADjD;IAEEiB,cAAc,EAAE,KAFlB;IAGEC,UAAU,EAAE,KAHd;IAIEC,QAAQ,EAAE,KAJZ;IAKE;IACA;IACAC,QAAQ,EAAE;EAPZ,CAH0C,CAA5C;EAaA,MAAMC,UAAU,GAAGN,eAAe,GAAGA,eAAe,CAACO,IAAnB,GAA0B,EAA5D;EACA,MAAMC,SAAS,GAAGC,MAAM,CAACC,IAAP,CAAYZ,KAAZ,CAAlB;EACA,MAAMa,WAAW,GAAGF,MAAM,CAACG,MAAP,CAAcd,KAAd,CAApB,CAhBE,CAiBF;;EACA,MAAMe,GAAG,GAAG,IAAIC,QAAJ,CAAa,OAAb,EAAsB,GAAGN,SAAzB,EAAoC,UAAUF,UAAU,EAAxD,CAAZ;EACA,OAAOO,GAAG,CAAC9B,KAAD,EAAQ,GAAG4B,WAAX,CAAV;AACD,CAxBD;;AA0BA,MAAMI,eAAe,GAAG,CACtBlB,GADsB,EAEtBC,KAFsB,EAGtBR,aAHsB,EAItBS,OAJsB,KAKpB;EACF,OAAOX,aAAa,CAACQ,QAAQ,CAACC,GAAD,EAAMC,KAAN,EAAaC,OAAb,CAAT,EAAgCT,aAAhC,CAApB;AACD,CAPD;;AASA,MAAM0B,SAAS,GAAG,CAChBT,IADgB,EAEhBU,eAFgB,EAGhBnB,KAHgB,EAIhBoB,SAJgB,EAKhBC,QALgB,EAMhBpB,OANgB,KAOd;EACF,IAAI;IACF,MAAMF,GAAG,GAAGoB,eAAe,CAACG,MAAhB,CACV,CAACC,MAAD,EAASC,cAAT,KAA4BA,cAAc,CAACD,MAAD,CADhC,EAEVnC,KAAK,CAACqB,IAAD,CAFK,CAAZ;IAIA,MAAMgB,SAAS,GAAGR,eAAe,CAC/BlB,GAD+B,EAE/BC,KAF+B,EAG9BJ,KAAD,IAAiB;MACfyB,QAAQ,CAACzB,KAAK,CAAC8B,QAAN,EAAD,CAAR;IACD,CAL8B,EAM/BzB,OAN+B,CAAjC;IAQAmB,SAAS,CAAC;MAACK;IAAD,CAAD,CAAT;IACAJ,QAAQ,CAAC,IAAD,CAAR;EACD,CAfD,CAeE,OAAOzB,KAAP,EAAc;IACdyB,QAAQ,CAACzB,KAAK,CAAC8B,QAAN,EAAD,CAAR;EACD;AACF,CA1BD;;AA4BA,MAAMC,QAAQ,GAA6B,QAStC;EAAA,IATuC;IAC1C3B,KAD0C;IAE1CS,IAF0C;IAG1CY,QAH0C;IAI1CF,eAJ0C;IAK1CS,WAL0C;IAM1CC,SAN0C;IAO1C5B,OAP0C;IAQ1C6B;EAR0C,CASvC;EACH,MAAM,CAACC,MAAD,EAASX,SAAT,IAAsBnC,KAAK,CAAC+C,QAAN,CAEzB;IAACP,SAAS,EAAE;EAAZ,CAFyB,CAA5B;EAIAxC,KAAK,CAACgD,SAAN,CAAgB,MAAK;IACnBf,SAAS,CAACT,IAAD,EAAOU,eAAP,EAAwBnB,KAAxB,EAA+BoB,SAA/B,EAA0CC,QAA1C,EAAoDpB,OAApD,CAAT;EACD,CAFD,EAEG,CAACQ,IAAD,CAFH;EAIA,MAAMlB,OAAO,GAAGwC,MAAM,CAACN,SAAvB;EACA,MAAMS,WAAW,GAAGN,WAApB;EACA,OACE3C,6CACMI,SAAS,CACX;IACE8C,OAAO,EAAE,MADX;IAEEC,cAAc,EAAE,QAFlB;IAGEC,UAAU,EAAE,UAHd;IAIEC,QAAQ,EAAE,MAJZ;IAKET,SAAS,EAAE,GAAGA,SAAS,IAAI,CAAC,IAL9B;IAMEU,UAAU,EAAEV,SAAS,GAAG,MAAH,GAAY,CANnC;IAOEW,aAAa,EAAEX,SAAS,GAAG,MAAH,GAAY;EAPtC,CADW,EAUXC,SAVW,CADf,GAcGvC,OAAO,GACNN,oBAACM,OAAD,EAAQ,IAAR,CADM,GAEJ2C,WAAW,GACbjD,oBAACiD,WAAD,EAAY;IAACO,MAAM,EAAEZ,SAAS,IAAI;EAAtB,CAAZ,CADa,GAEX,IAlBN,CADF;AAsBD,CA1CD;;AA4CA,eAAe5C,KAAK,CAACyD,IAAN,CACbf,QADa,EAEb,CAACgB,SAAD,EAAYC,SAAZ,KAA0BD,SAAS,CAAClC,IAAV,KAAmBmC,SAAS,CAACnC,IAF1C,CAAf","names":["React","transformFromAstSync","presetReact","parse","getStyles","errorBoundary","Element","errorCallback","ErrorBoundary","Component","componentDidCatch","error","render","evalCode","ast","scope","presets","transformedCode","undefined","inputSourceMap","sourceMaps","comments","filename","resultCode","code","scopeKeys","Object","keys","scopeValues","values","res","Function","generateElement","transpile","transformations","setOutput","setError","reduce","result","transformation","component","toString","Compiler","placeholder","minHeight","className","output","useState","useEffect","Placeholder","display","justifyContent","alignItems","flexWrap","paddingTop","paddingBottom","height","memo","prevProps","nextProps"],"sources":["../../../src/ui/compiler.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}